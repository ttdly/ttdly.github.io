---
title: 用JavaScript创建GitHub Action
create: 2023-03-31T02:36:53Z
update: 2023-04-01T13:00:59Z
labels: ["github"]
---

## 初始化
首先创建一个仓库
```shell
git init
```
然后，初始化项目
```shell
npm init
```
接着安装相关依赖[@actions/core](https://github.com/actions/toolkit/tree/main/packages/core)[@actions/github](https://github.com/actions/toolkit/tree/main/packages/github)  
其他的工具包在这里[toolkit](https://github.com/actions/toolkit)  
但是想用GitHub API的话就不用安装octokit了，因为`@actions/github`已经封装好了这个包。
```shell
npm install -D @actions/core @actions/github
```

## 配置文件
新建`action.yml`
```yaml
name: 'say hello'
description: 'test for GitHub Actions!'
# 需要输入的字段
inputs:
  # 输入字段名称
  name:
    # 字段描述
    description: 'name'
    # 默认值 
    default: 'ttdly'
    # 是否必须
    required: true
# 需要输出的字段
outputs: 
  hello: 
    description: 'say hello'

runs:
  using: 'node16'
  main: 'index.js'
```
关于`action.yml`的语法，可以参考[官方文档](https://docs.github.com/en/actions/creating-actions/metadata-syntax-for-github-actions#outputs-for-docker-container-and-javascript-actions)，但是上面俩字段基本够用了。

## 编写&本地测试
新建js入口文件`index.js`，可以是任何名称，但是runs.mian.<name>字段一定要和入口文件名字一致
### 输入输出
```javascript
const core = require('@actions/core');
const github = require('@actions/github');

const core = require('@actions/core')

async function run(){
  try {
    const name = core.getInput('name')
    core.setOutput('hello', `Hello ${name}`)
  } catch (err) {
    core.setFailed(err.message)
  }
}

run()
```
可以看的出来，平时Javascript怎么写，这里就能怎么写，只是输入输出方式不一样，这里列举一下输出的类型：
- core.info()
- core.debug()
- core.warning()
- core.notice()
- core.error()

### 结合GitHub API
